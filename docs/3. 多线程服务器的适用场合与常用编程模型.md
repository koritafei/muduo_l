## 多线程服务器的适用场合与常用编程模型
### 进程与线程
进程(`process`): 内存中正在运行的程序；
每个进程都有自己的独立地址空间。
线程(`thread`):cpu调度的基本单位。
共享地址空间，从而可以高效的共享数据。

### 多线程编程模式
常用的有：
1. 每个请求创建一个线程，使用阻塞式`IO`操作；
2. 使用线程池，同样为阻塞式`IO`操作；
3. 使用`non-blocking IO + IO multiplexing`
4. `Leader/Follwer`等高级模式

#### `one loop per thread`
每个`IO`线程都有一个`event loop`。
这种方式的优点：
1. 线程数目基本固定，可以在程序启动的时候设置，不会频繁创建与销毁；
2. 可以方便的在线程间调配负载；
3. `IO`事件发生的线程是固定的，同一个`TCP`连接无需考虑事件并发。

`EventLoop`代表了线程的主循环，需要哪个线程工作，将`timer或IO channel`注册到哪个线程的`loop`里即可。
#### 进程间通信采用`TCP`
优点有：
1. 可以跨机器通信；
2. 进程出错，能够立刻感知到；
3. 可记录与重现。

必须使用单线程的场景：
> 1. 程序可能`fork`;
> 2. 限制程序的`CPU`利用率。

线程的分类：
1. `IO`线程，主循环是`IO multiplexing`,阻塞的等待`select/epoll/poll/epoll_wait`等系统调用；
2. 计算线程，这类线程的主循环是`blocking queue`,阻塞的等待在`condition variable`上，这类线程一般位于`thread pool`上，不涉及`IO`;
3. 第三方库所用的线程。


